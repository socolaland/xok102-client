<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <title>Xok102</title>

    <!--http://www.html5rocks.com/en/mobile/mobifying/-->
    <meta name="viewport"
        content="width=device-width,user-scalable=no,initial-scale=1, minimum-scale=1,maximum-scale=1" />

    <!--https://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html-->
    <meta name="apple-mobile-web-app-capable" content="no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

    <!-- force webkit on 360 -->
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <!-- force edge on IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="msapplication-tap-highlight" content="no">

    <!-- force full screen on some browser -->
    <meta name="full-screen" content="no" />
    <meta name="x5-fullscreen" content="no" />
    <meta name="360-fullscreen" content="no" />

    <!-- force screen orientation on some browser -->
    <meta name="screen-orientation" content="portrait" />
    <meta name="x5-orientation" content="portrait">

    <!--fix fireball/issues/3568 -->
    <!--<meta name="browsermode" content="application">-->
    <meta name="x5-page-mode" content="app">

    <!--<link rel="apple-touch-icon" href=".png" />-->
    <!--<link rel="apple-touch-icon-precomposed" href=".png" />-->

    <link rel="stylesheet" type="text/css" href="style-mobile.css" />
    <link rel="icon" type="image/png" href="./favicon.png" />

    <style>
        html,
        body {
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100%;
        }
    </style>

    <script type="text/javascript">
        history.pushState({ 'homepage': true }, document.title, location.href);
        window.onpopstate = function (event) {
            if (event && event.state) {
                history.go(1);
                location.reload();
            }
        };
    </script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BJ1R8SSE7E"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-BJ1R8SSE7E');
    </script>
</head>

<body>
    <canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="0"></canvas>
    <div id="splash">
        <div id="splash-image">
        </div>
        <div class="progress-bar" id="progress-bar">
            <span style="width:0%"></span>
        </div>
        <div class="loading-text" id="loading-text">LOADING: 0%</div>
        <div class="div-low-network">
            <!--<button class="button-low-network" type="button"></button>-->
        </div>
    </div>

    <script src="src/settings.js" charset="utf-8"></script>

    <script src="main.js" charset="utf-8"></script>

    <script src="https://cdn.rawgit.com/turuslan/HackTimer/master/HackTimer.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>

    <script type="text/javascript">
        var vis = (function () {
            var stateKey, eventKey, keys = {
                hidden: "visibilitychange",
                webkitHidden: "webkitvisibilitychange",
                mozHidden: "mozvisibilitychange",
                msHidden: "msvisibilitychange"
            };
            for (stateKey in keys) {
                if (stateKey in document) {
                    eventKey = keys[stateKey];
                    break;
                }
            }
            return function (c) {
                if (c) document.addEventListener(eventKey, c);
                return !document[stateKey];
            }
        })();

        var isMobile = {
            Android: function () {
                return navigator.userAgent.match(/Android/i);
            },
            BlackBerry: function () {
                return navigator.userAgent.match(/BlackBerry/i);
            },
            iOS: function () {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i);
            },
            Opera: function () {
                return navigator.userAgent.match(/Opera Mini/i);
            },
            Windows: function () {
                return navigator.userAgent.match(/IEMobile/i);
            },
            any: function () {
                return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
            }
        };
        if (isMobile.any()) {
            //window.location = "/mobile";
            console.log("Detected Mobile Device!!!");
        }

        (function () {
            // open web debugger console
            if (typeof VConsole !== 'undefined') {
                window.vConsole = new VConsole();
            }

            var splash = document.getElementById('splash');
            splash.style.display = 'block';

            var cocos2d = document.createElement('script');
            cocos2d.async = true;
            cocos2d.src = window._CCSettings.debug ? 'cocos2d-js.js' : 'cocos2d-js-min.js';

            var engineLoaded = function () {
                document.body.removeChild(cocos2d);
                cocos2d.removeEventListener('load', engineLoaded, false);
                window.boot();
            };
            cocos2d.addEventListener('load', engineLoaded, false);
            document.body.appendChild(cocos2d);
        })();

        window.onload = function () {
            document.addEventListener("contextmenu", function (e) {
                e.preventDefault();
            }, false);
            document.addEventListener("keydown", function (e) {
                //document.onkeydown = function(e) {
                // "I" key
                if (e.ctrlKey && e.shiftKey && e.keyCode == 73) {
                    disabledEvent(e);
                }
                // "J" key
                if (e.ctrlKey && e.shiftKey && e.keyCode == 74) {
                    disabledEvent(e);
                }
                // "S" key + macOS
                if (e.keyCode == 83 && (navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)) {
                    disabledEvent(e);
                }
                // "U" key
                if (e.ctrlKey && e.keyCode == 85) {
                    disabledEvent(e);
                }
                // "F12" key
                if (event.keyCode == 123) {
                    disabledEvent(e);
                }
            }, false);

            function disabledEvent(e) {
                if (e.stopPropagation) {
                    e.stopPropagation();
                } else if (window.event) {
                    window.event.cancelBubble = true;
                }
                e.preventDefault();
                return false;
            }

            let scheduleReload; // schedule for reload page when user changed tab
            let isTimeOut = false;

            var visible = vis(); // gives current state
            vis(function () {
                if (vis()) {
                    //location.reload();
                    if (isTimeOut) {
                        location.reload();
                    } else {
                        clearTimeout(scheduleReload);
                    }
                } else {
                    scheduleReload = setTimeout(() => {
                        isTimeOut = true;
                    }, isMobile.any() ? 15000 : 60000);
                }
            });
        }

        setTimeout(() => {
            try {
                document.exitFullscreen();
            }catch(e) {}
        }, 100);

        // serviceWorker
        // if ('serviceWorker' in navigator) {
        //     window.addEventListener('load', () => {
        //         navigator.serviceWorker.register('service-worker.js')
        //             .then(swReg => {
        //                 console.log('Service Worker is registered', swReg);
        //             })
        //             .catch(err => {
        //                 console.error('Service Worker Error', err);
        //             });
        //     });
        // }

        function getQueryParam(url, key) {
            const urlObj = new URL(url);
            const value = urlObj.searchParams.get(key);
            return value === null ? null : value;
        }

        window.addEventListener('load', () => {
            if (getQueryParam(window.location.href, 'access_token')) {
                localStorage.setItem('access_token', getQueryParam(window.location.href, 'access_token'));
            }
            if (getQueryParam(window.location.href, 'refresh_token')) {
                localStorage.setItem('refresh_token', getQueryParam(window.location.href, 'refresh_token'));
            }
            window.history.replaceState({}, '', '/');
            
            
            
            
        });

    </script>
    <!--<script src="audio-context-fix.js"></script>-->
</body>

</html> 